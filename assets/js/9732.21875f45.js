"use strict";(self.webpackChunkregal_ui_docs=self.webpackChunkregal_ui_docs||[]).push([[9732],{89732:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{eval('/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   diagram: () => (/* binding */ diagram)\n/* harmony export */ });\n/* harmony import */ var _chunk_7U56Z5CX_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(90758);\n/* harmony import */ var _chunk_5HRBRIJM_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(96474);\n/* harmony import */ var _chunk_BO7VGL7K_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(87308);\n/* harmony import */ var _chunk_66SQ7PYY_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(37938);\n/* harmony import */ var _chunk_7NZE2EM7_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(1282);\n/* harmony import */ var _chunk_OPO4IU42_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(64532);\n/* harmony import */ var _chunk_3JNJP5BE_mjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(47588);\n/* harmony import */ var _chunk_3X56UNUX_mjs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(33115);\n/* harmony import */ var _chunk_6JOS74DS_mjs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(10483);\n/* harmony import */ var _chunk_7DKRZKHE_mjs__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(8159);\n/* harmony import */ var _chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(10009);\n/* harmony import */ var d3__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(20007);\n/* harmony import */ var dagre_d3_es_src_dagre_index_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(62334);\n/* harmony import */ var dagre_d3_es_src_graphlib_index_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(697);\n\n\n\n\n\n\n\n\n\n\n\n\n// src/diagrams/state/stateRenderer.js\n\n\n\n\n// src/diagrams/state/shapes.js\n\n\n// src/diagrams/state/id-cache.js\nvar idCache = {};\nvar set = /* @__PURE__ */ (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .__name */ .K2)((key, val) => {\n  idCache[key] = val;\n}, "set");\nvar get = /* @__PURE__ */ (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .__name */ .K2)((k) => idCache[k], "get");\nvar keys = /* @__PURE__ */ (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .__name */ .K2)(() => Object.keys(idCache), "keys");\nvar size = /* @__PURE__ */ (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .__name */ .K2)(() => keys().length, "size");\nvar id_cache_default = {\n  get,\n  set,\n  keys,\n  size\n};\n\n// src/diagrams/state/shapes.js\nvar drawStartState = /* @__PURE__ */ (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .__name */ .K2)((g) => g.append("circle").attr("class", "start-state").attr("r", (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.sizeUnit).attr("cx", (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.padding + (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.sizeUnit).attr("cy", (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.padding + (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.sizeUnit), "drawStartState");\nvar drawDivider = /* @__PURE__ */ (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .__name */ .K2)((g) => g.append("line").style("stroke", "grey").style("stroke-dasharray", "3").attr("x1", (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.textHeight).attr("class", "divider").attr("x2", (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.textHeight * 2).attr("y1", 0).attr("y2", 0), "drawDivider");\nvar drawSimpleState = /* @__PURE__ */ (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .__name */ .K2)((g, stateDef) => {\n  const state = g.append("text").attr("x", 2 * (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.padding).attr("y", (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.textHeight + 2 * (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.padding).attr("font-size", (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.fontSize).attr("class", "state-title").text(stateDef.id);\n  const classBox = state.node().getBBox();\n  g.insert("rect", ":first-child").attr("x", (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.padding).attr("y", (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.padding).attr("width", classBox.width + 2 * (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.padding).attr("height", classBox.height + 2 * (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.padding).attr("rx", (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.radius);\n  return state;\n}, "drawSimpleState");\nvar drawDescrState = /* @__PURE__ */ (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .__name */ .K2)((g, stateDef) => {\n  const addTspan = /* @__PURE__ */ (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .__name */ .K2)(function(textEl, txt, isFirst2) {\n    const tSpan = textEl.append("tspan").attr("x", 2 * (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.padding).text(txt);\n    if (!isFirst2) {\n      tSpan.attr("dy", (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.textHeight);\n    }\n  }, "addTspan");\n  const title = g.append("text").attr("x", 2 * (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.padding).attr("y", (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.textHeight + 1.3 * (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.padding).attr("font-size", (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.fontSize).attr("class", "state-title").text(stateDef.descriptions[0]);\n  const titleBox = title.node().getBBox();\n  const titleHeight = titleBox.height;\n  const description = g.append("text").attr("x", (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.padding).attr(\n    "y",\n    titleHeight + (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.padding * 0.4 + (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.dividerMargin + (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.textHeight\n  ).attr("class", "state-description");\n  let isFirst = true;\n  let isSecond = true;\n  stateDef.descriptions.forEach(function(descr) {\n    if (!isFirst) {\n      addTspan(description, descr, isSecond);\n      isSecond = false;\n    }\n    isFirst = false;\n  });\n  const descrLine = g.append("line").attr("x1", (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.padding).attr("y1", (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.padding + titleHeight + (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.dividerMargin / 2).attr("y2", (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.padding + titleHeight + (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.dividerMargin / 2).attr("class", "descr-divider");\n  const descrBox = description.node().getBBox();\n  const width = Math.max(descrBox.width, titleBox.width);\n  descrLine.attr("x2", width + 3 * (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.padding);\n  g.insert("rect", ":first-child").attr("x", (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.padding).attr("y", (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.padding).attr("width", width + 2 * (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.padding).attr("height", descrBox.height + titleHeight + 2 * (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.padding).attr("rx", (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.radius);\n  return g;\n}, "drawDescrState");\nvar addTitleAndBox = /* @__PURE__ */ (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .__name */ .K2)((g, stateDef, altBkg) => {\n  const pad = (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.padding;\n  const dblPad = 2 * (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.padding;\n  const orgBox = g.node().getBBox();\n  const orgWidth = orgBox.width;\n  const orgX = orgBox.x;\n  const title = g.append("text").attr("x", 0).attr("y", (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.titleShift).attr("font-size", (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.fontSize).attr("class", "state-title").text(stateDef.id);\n  const titleBox = title.node().getBBox();\n  const titleWidth = titleBox.width + dblPad;\n  let width = Math.max(titleWidth, orgWidth);\n  if (width === orgWidth) {\n    width = width + dblPad;\n  }\n  let startX;\n  const graphBox = g.node().getBBox();\n  if (stateDef.doc) {\n  }\n  startX = orgX - pad;\n  if (titleWidth > orgWidth) {\n    startX = (orgWidth - width) / 2 + pad;\n  }\n  if (Math.abs(orgX - graphBox.x) < pad && titleWidth > orgWidth) {\n    startX = orgX - (titleWidth - orgWidth) / 2;\n  }\n  const lineY = 1 - (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.textHeight;\n  g.insert("rect", ":first-child").attr("x", startX).attr("y", lineY).attr("class", altBkg ? "alt-composit" : "composit").attr("width", width).attr(\n    "height",\n    graphBox.height + (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.textHeight + (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.titleShift + 1\n  ).attr("rx", "0");\n  title.attr("x", startX + pad);\n  if (titleWidth <= orgWidth) {\n    title.attr("x", orgX + (width - dblPad) / 2 - titleWidth / 2 + pad);\n  }\n  g.insert("rect", ":first-child").attr("x", startX).attr(\n    "y",\n    (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.titleShift - (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.textHeight - (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.padding\n  ).attr("width", width).attr("height", (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.textHeight * 3).attr("rx", (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.radius);\n  g.insert("rect", ":first-child").attr("x", startX).attr(\n    "y",\n    (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.titleShift - (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.textHeight - (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.padding\n  ).attr("width", width).attr("height", graphBox.height + 3 + 2 * (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.textHeight).attr("rx", (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.radius);\n  return g;\n}, "addTitleAndBox");\nvar drawEndState = /* @__PURE__ */ (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .__name */ .K2)((g) => {\n  g.append("circle").attr("class", "end-state-outer").attr("r", (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.sizeUnit + (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.miniPadding).attr(\n    "cx",\n    (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.padding + (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.sizeUnit + (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.miniPadding\n  ).attr(\n    "cy",\n    (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.padding + (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.sizeUnit + (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.miniPadding\n  );\n  return g.append("circle").attr("class", "end-state-inner").attr("r", (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.sizeUnit).attr("cx", (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.padding + (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.sizeUnit + 2).attr("cy", (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.padding + (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.sizeUnit + 2);\n}, "drawEndState");\nvar drawForkJoinState = /* @__PURE__ */ (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .__name */ .K2)((g, stateDef) => {\n  let width = (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.forkWidth;\n  let height = (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.forkHeight;\n  if (stateDef.parentId) {\n    let tmp = width;\n    width = height;\n    height = tmp;\n  }\n  return g.append("rect").style("stroke", "black").style("fill", "black").attr("width", width).attr("height", height).attr("x", (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.padding).attr("y", (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.padding);\n}, "drawForkJoinState");\nvar _drawLongText = /* @__PURE__ */ (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .__name */ .K2)((_text, x, y, g) => {\n  let textHeight = 0;\n  const textElem = g.append("text");\n  textElem.style("text-anchor", "start");\n  textElem.attr("class", "noteText");\n  let text = _text.replace(/\\r\\n/g, "<br/>");\n  text = text.replace(/\\n/g, "<br/>");\n  const lines = text.split(_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .common_default */ .Y2.lineBreakRegex);\n  let tHeight = 1.25 * (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.noteMargin;\n  for (const line2 of lines) {\n    const txt = line2.trim();\n    if (txt.length > 0) {\n      const span = textElem.append("tspan");\n      span.text(txt);\n      if (tHeight === 0) {\n        const textBounds = span.node().getBBox();\n        tHeight += textBounds.height;\n      }\n      textHeight += tHeight;\n      span.attr("x", x + (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.noteMargin);\n      span.attr("y", y + textHeight + 1.25 * (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.noteMargin);\n    }\n  }\n  return { textWidth: textElem.node().getBBox().width, textHeight };\n}, "_drawLongText");\nvar drawNote = /* @__PURE__ */ (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .__name */ .K2)((text, g) => {\n  g.attr("class", "state-note");\n  const note = g.append("rect").attr("x", 0).attr("y", (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.padding);\n  const rectElem = g.append("g");\n  const { textWidth, textHeight } = _drawLongText(text, 0, 0, rectElem);\n  note.attr("height", textHeight + 2 * (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.noteMargin);\n  note.attr("width", textWidth + (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.noteMargin * 2);\n  return note;\n}, "drawNote");\nvar drawState = /* @__PURE__ */ (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .__name */ .K2)(function(elem, stateDef) {\n  const id = stateDef.id;\n  const stateInfo = {\n    id,\n    label: stateDef.id,\n    width: 0,\n    height: 0\n  };\n  const g = elem.append("g").attr("id", id).attr("class", "stateGroup");\n  if (stateDef.type === "start") {\n    drawStartState(g);\n  }\n  if (stateDef.type === "end") {\n    drawEndState(g);\n  }\n  if (stateDef.type === "fork" || stateDef.type === "join") {\n    drawForkJoinState(g, stateDef);\n  }\n  if (stateDef.type === "note") {\n    drawNote(stateDef.note.text, g);\n  }\n  if (stateDef.type === "divider") {\n    drawDivider(g);\n  }\n  if (stateDef.type === "default" && stateDef.descriptions.length === 0) {\n    drawSimpleState(g, stateDef);\n  }\n  if (stateDef.type === "default" && stateDef.descriptions.length > 0) {\n    drawDescrState(g, stateDef);\n  }\n  const stateBox = g.node().getBBox();\n  stateInfo.width = stateBox.width + 2 * (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.padding;\n  stateInfo.height = stateBox.height + 2 * (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.padding;\n  id_cache_default.set(id, stateInfo);\n  return stateInfo;\n}, "drawState");\nvar edgeCount = 0;\nvar drawEdge = /* @__PURE__ */ (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .__name */ .K2)(function(elem, path, relation) {\n  const getRelationType = /* @__PURE__ */ (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .__name */ .K2)(function(type) {\n    switch (type) {\n      case _chunk_7U56Z5CX_mjs__WEBPACK_IMPORTED_MODULE_0__/* .stateDb_default */ .iP.relationType.AGGREGATION:\n        return "aggregation";\n      case _chunk_7U56Z5CX_mjs__WEBPACK_IMPORTED_MODULE_0__/* .stateDb_default */ .iP.relationType.EXTENSION:\n        return "extension";\n      case _chunk_7U56Z5CX_mjs__WEBPACK_IMPORTED_MODULE_0__/* .stateDb_default */ .iP.relationType.COMPOSITION:\n        return "composition";\n      case _chunk_7U56Z5CX_mjs__WEBPACK_IMPORTED_MODULE_0__/* .stateDb_default */ .iP.relationType.DEPENDENCY:\n        return "dependency";\n    }\n  }, "getRelationType");\n  path.points = path.points.filter((p) => !Number.isNaN(p.y));\n  const lineData = path.points;\n  const lineFunction = (0,d3__WEBPACK_IMPORTED_MODULE_11__/* .line */ .n8j)().x(function(d) {\n    return d.x;\n  }).y(function(d) {\n    return d.y;\n  }).curve(d3__WEBPACK_IMPORTED_MODULE_11__/* .curveBasis */ .qrM);\n  const svgPath = elem.append("path").attr("d", lineFunction(lineData)).attr("id", "edge" + edgeCount).attr("class", "transition");\n  let url = "";\n  if ((0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.arrowMarkerAbsolute) {\n    url = window.location.protocol + "//" + window.location.host + window.location.pathname + window.location.search;\n    url = url.replace(/\\(/g, "\\\\(");\n    url = url.replace(/\\)/g, "\\\\)");\n  }\n  svgPath.attr(\n    "marker-end",\n    "url(" + url + "#" + getRelationType(_chunk_7U56Z5CX_mjs__WEBPACK_IMPORTED_MODULE_0__/* .stateDb_default */ .iP.relationType.DEPENDENCY) + "End)"\n  );\n  if (relation.title !== void 0) {\n    const label = elem.append("g").attr("class", "stateLabel");\n    const { x, y } = _chunk_7DKRZKHE_mjs__WEBPACK_IMPORTED_MODULE_9__/* .utils_default */ ._K.calcLabelPosition(path.points);\n    const rows = _chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .common_default */ .Y2.getRows(relation.title);\n    let titleHeight = 0;\n    const titleRows = [];\n    let maxWidth = 0;\n    let minX = 0;\n    for (let i = 0; i <= rows.length; i++) {\n      const title = label.append("text").attr("text-anchor", "middle").text(rows[i]).attr("x", x).attr("y", y + titleHeight);\n      const boundsTmp = title.node().getBBox();\n      maxWidth = Math.max(maxWidth, boundsTmp.width);\n      minX = Math.min(minX, boundsTmp.x);\n      _chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .log */ .Rm.info(boundsTmp.x, x, y + titleHeight);\n      if (titleHeight === 0) {\n        const titleBox = title.node().getBBox();\n        titleHeight = titleBox.height;\n        _chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .log */ .Rm.info("Title height", titleHeight, y);\n      }\n      titleRows.push(title);\n    }\n    let boxHeight = titleHeight * rows.length;\n    if (rows.length > 1) {\n      const heightAdj = (rows.length - 1) * titleHeight * 0.5;\n      titleRows.forEach((title, i) => title.attr("y", y + i * titleHeight - heightAdj));\n      boxHeight = titleHeight * rows.length;\n    }\n    const bounds = label.node().getBBox();\n    label.insert("rect", ":first-child").attr("class", "box").attr("x", x - maxWidth / 2 - (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.padding / 2).attr("y", y - boxHeight / 2 - (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.padding / 2 - 3.5).attr("width", maxWidth + (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.padding).attr("height", boxHeight + (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state.padding);\n    _chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .log */ .Rm.info(bounds);\n  }\n  edgeCount++;\n}, "drawEdge");\n\n// src/diagrams/state/stateRenderer.js\nvar conf;\nvar transformationLog = {};\nvar setConf = /* @__PURE__ */ (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .__name */ .K2)(function() {\n}, "setConf");\nvar insertMarkers = /* @__PURE__ */ (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .__name */ .K2)(function(elem) {\n  elem.append("defs").append("marker").attr("id", "dependencyEnd").attr("refX", 19).attr("refY", 7).attr("markerWidth", 20).attr("markerHeight", 28).attr("orient", "auto").append("path").attr("d", "M 19,7 L9,13 L14,7 L9,1 Z");\n}, "insertMarkers");\nvar draw = /* @__PURE__ */ (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .__name */ .K2)(function(text, id, _version, diagObj) {\n  conf = (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().state;\n  const securityLevel = (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .getConfig2 */ .D7)().securityLevel;\n  let sandboxElement;\n  if (securityLevel === "sandbox") {\n    sandboxElement = (0,d3__WEBPACK_IMPORTED_MODULE_11__/* .select */ .Ltv)("#i" + id);\n  }\n  const root = securityLevel === "sandbox" ? (0,d3__WEBPACK_IMPORTED_MODULE_11__/* .select */ .Ltv)(sandboxElement.nodes()[0].contentDocument.body) : (0,d3__WEBPACK_IMPORTED_MODULE_11__/* .select */ .Ltv)("body");\n  const doc = securityLevel === "sandbox" ? sandboxElement.nodes()[0].contentDocument : document;\n  _chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .log */ .Rm.debug("Rendering diagram " + text);\n  const diagram2 = root.select(`[id=\'${id}\']`);\n  insertMarkers(diagram2);\n  const rootDoc = diagObj.db.getRootDoc();\n  renderDoc(rootDoc, diagram2, void 0, false, root, doc, diagObj);\n  const padding = conf.padding;\n  const bounds = diagram2.node().getBBox();\n  const width = bounds.width + padding * 2;\n  const height = bounds.height + padding * 2;\n  const svgWidth = width * 1.75;\n  (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .configureSvgSize */ .a$)(diagram2, height, svgWidth, conf.useMaxWidth);\n  diagram2.attr(\n    "viewBox",\n    `${bounds.x - conf.padding}  ${bounds.y - conf.padding} ` + width + " " + height\n  );\n}, "draw");\nvar getLabelWidth = /* @__PURE__ */ (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .__name */ .K2)((text) => {\n  return text ? text.length * conf.fontSizeFactor : 1;\n}, "getLabelWidth");\nvar renderDoc = /* @__PURE__ */ (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .__name */ .K2)((doc, diagram2, parentId, altBkg, root, domDocument, diagObj) => {\n  const graph = new dagre_d3_es_src_graphlib_index_js__WEBPACK_IMPORTED_MODULE_13__/* .Graph */ .T({\n    compound: true,\n    multigraph: true\n  });\n  let i;\n  let edgeFreeDoc = true;\n  for (i = 0; i < doc.length; i++) {\n    if (doc[i].stmt === "relation") {\n      edgeFreeDoc = false;\n      break;\n    }\n  }\n  if (parentId) {\n    graph.setGraph({\n      rankdir: "LR",\n      multigraph: true,\n      compound: true,\n      // acyclicer: \'greedy\',\n      ranker: "tight-tree",\n      ranksep: edgeFreeDoc ? 1 : conf.edgeLengthFactor,\n      nodeSep: edgeFreeDoc ? 1 : 50,\n      isMultiGraph: true\n      // ranksep: 5,\n      // nodesep: 1\n    });\n  } else {\n    graph.setGraph({\n      rankdir: "TB",\n      multigraph: true,\n      compound: true,\n      // isCompound: true,\n      // acyclicer: \'greedy\',\n      // ranker: \'longest-path\'\n      ranksep: edgeFreeDoc ? 1 : conf.edgeLengthFactor,\n      nodeSep: edgeFreeDoc ? 1 : 50,\n      ranker: "tight-tree",\n      // ranker: \'network-simplex\'\n      isMultiGraph: true\n    });\n  }\n  graph.setDefaultEdgeLabel(function() {\n    return {};\n  });\n  diagObj.db.extract(doc);\n  const states = diagObj.db.getStates();\n  const relations = diagObj.db.getRelations();\n  const keys2 = Object.keys(states);\n  let first = true;\n  for (const key of keys2) {\n    const stateDef = states[key];\n    if (parentId) {\n      stateDef.parentId = parentId;\n    }\n    let node;\n    if (stateDef.doc) {\n      let sub = diagram2.append("g").attr("id", stateDef.id).attr("class", "stateGroup");\n      node = renderDoc(stateDef.doc, sub, stateDef.id, !altBkg, root, domDocument, diagObj);\n      if (first) {\n        sub = addTitleAndBox(sub, stateDef, altBkg);\n        let boxBounds = sub.node().getBBox();\n        node.width = boxBounds.width;\n        node.height = boxBounds.height + conf.padding / 2;\n        transformationLog[stateDef.id] = { y: conf.compositTitleSize };\n      } else {\n        let boxBounds = sub.node().getBBox();\n        node.width = boxBounds.width;\n        node.height = boxBounds.height;\n      }\n    } else {\n      node = drawState(diagram2, stateDef, graph);\n    }\n    if (stateDef.note) {\n      const noteDef = {\n        descriptions: [],\n        id: stateDef.id + "-note",\n        note: stateDef.note,\n        type: "note"\n      };\n      const note = drawState(diagram2, noteDef, graph);\n      if (stateDef.note.position === "left of") {\n        graph.setNode(node.id + "-note", note);\n        graph.setNode(node.id, node);\n      } else {\n        graph.setNode(node.id, node);\n        graph.setNode(node.id + "-note", note);\n      }\n      graph.setParent(node.id, node.id + "-group");\n      graph.setParent(node.id + "-note", node.id + "-group");\n    } else {\n      graph.setNode(node.id, node);\n    }\n  }\n  _chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .log */ .Rm.debug("Count=", graph.nodeCount(), graph);\n  let cnt = 0;\n  relations.forEach(function(relation) {\n    cnt++;\n    _chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .log */ .Rm.debug("Setting edge", relation);\n    graph.setEdge(\n      relation.id1,\n      relation.id2,\n      {\n        relation,\n        width: getLabelWidth(relation.title),\n        height: conf.labelHeight * _chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .common_default */ .Y2.getRows(relation.title).length,\n        labelpos: "c"\n      },\n      "id" + cnt\n    );\n  });\n  (0,dagre_d3_es_src_dagre_index_js__WEBPACK_IMPORTED_MODULE_12__/* .layout */ .Zp)(graph);\n  _chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .log */ .Rm.debug("Graph after layout", graph.nodes());\n  const svgElem = diagram2.node();\n  graph.nodes().forEach(function(v) {\n    if (v !== void 0 && graph.node(v) !== void 0) {\n      _chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .log */ .Rm.warn("Node " + v + ": " + JSON.stringify(graph.node(v)));\n      root.select("#" + svgElem.id + " #" + v).attr(\n        "transform",\n        "translate(" + (graph.node(v).x - graph.node(v).width / 2) + "," + (graph.node(v).y + (transformationLog[v] ? transformationLog[v].y : 0) - graph.node(v).height / 2) + " )"\n      );\n      root.select("#" + svgElem.id + " #" + v).attr("data-x-shift", graph.node(v).x - graph.node(v).width / 2);\n      const dividers = domDocument.querySelectorAll("#" + svgElem.id + " #" + v + " .divider");\n      dividers.forEach((divider) => {\n        const parent = divider.parentElement;\n        let pWidth = 0;\n        let pShift = 0;\n        if (parent) {\n          if (parent.parentElement) {\n            pWidth = parent.parentElement.getBBox().width;\n          }\n          pShift = parseInt(parent.getAttribute("data-x-shift"), 10);\n          if (Number.isNaN(pShift)) {\n            pShift = 0;\n          }\n        }\n        divider.setAttribute("x1", 0 - pShift + 8);\n        divider.setAttribute("x2", pWidth - pShift - 8);\n      });\n    } else {\n      _chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .log */ .Rm.debug("No Node " + v + ": " + JSON.stringify(graph.node(v)));\n    }\n  });\n  let stateBox = svgElem.getBBox();\n  graph.edges().forEach(function(e) {\n    if (e !== void 0 && graph.edge(e) !== void 0) {\n      _chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .log */ .Rm.debug("Edge " + e.v + " -> " + e.w + ": " + JSON.stringify(graph.edge(e)));\n      drawEdge(diagram2, graph.edge(e), graph.edge(e).relation);\n    }\n  });\n  stateBox = svgElem.getBBox();\n  const stateInfo = {\n    id: parentId ? parentId : "root",\n    label: parentId ? parentId : "root",\n    width: 0,\n    height: 0\n  };\n  stateInfo.width = stateBox.width + 2 * conf.padding;\n  stateInfo.height = stateBox.height + 2 * conf.padding;\n  _chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .log */ .Rm.debug("Doc rendered", stateInfo, graph);\n  return stateInfo;\n}, "renderDoc");\nvar stateRenderer_default = {\n  setConf,\n  draw\n};\n\n// src/diagrams/state/stateDiagram.ts\nvar diagram = {\n  parser: _chunk_7U56Z5CX_mjs__WEBPACK_IMPORTED_MODULE_0__/* .stateDiagram_default */ .Zk,\n  db: _chunk_7U56Z5CX_mjs__WEBPACK_IMPORTED_MODULE_0__/* .stateDb_default */ .iP,\n  renderer: stateRenderer_default,\n  styles: _chunk_7U56Z5CX_mjs__WEBPACK_IMPORTED_MODULE_0__/* .styles_default */ .tM,\n  init: /* @__PURE__ */ (0,_chunk_6DBFFHIP_mjs__WEBPACK_IMPORTED_MODULE_10__/* .__name */ .K2)((cnf) => {\n    if (!cnf.state) {\n      cnf.state = {};\n    }\n    cnf.state.arrowMarkerAbsolute = cnf.arrowMarkerAbsolute;\n    _chunk_7U56Z5CX_mjs__WEBPACK_IMPORTED_MODULE_0__/* .stateDb_default */ .iP.clear();\n  }, "init")\n};\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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VSwrRUFBb0I7QUFDOUIsTUFBTSwwRUFBZTtBQUNyQjtBQUNBLFVBQVUseUVBQWM7QUFDeEIsd0JBQXdCLHNFQUFNO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSSwwRUFBZTtBQUNuQixHQUFHO0FBQ0g7QUFHRSIsInNvdXJjZXMiOlsid2VicGFjazovL3JlZ2FsLXVpLWRvY3MvLi9ub2RlX21vZHVsZXMvbWVybWFpZC9kaXN0L2NodW5rcy9tZXJtYWlkLmNvcmUvc3RhdGVEaWFncmFtLU1BWUhVTFI0Lm1qcz9iNWZiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIHN0YXRlRGJfZGVmYXVsdCxcbiAgc3RhdGVEaWFncmFtX2RlZmF1bHQsXG4gIHN0eWxlc19kZWZhdWx0XG59IGZyb20gXCIuL2NodW5rLTdVNTZaNUNYLm1qc1wiO1xuaW1wb3J0IFwiLi9jaHVuay01SFJCUklKTS5tanNcIjtcbmltcG9ydCBcIi4vY2h1bmstQk83VkdMN0subWpzXCI7XG5pbXBvcnQgXCIuL2NodW5rLTY2U1E3UFlZLm1qc1wiO1xuaW1wb3J0IFwiLi9jaHVuay03TlpFMkVNNy5tanNcIjtcbmltcG9ydCBcIi4vY2h1bmstT1BPNElVNDIubWpzXCI7XG5pbXBvcnQgXCIuL2NodW5rLTNKTkpQNUJFLm1qc1wiO1xuaW1wb3J0IFwiLi9jaHVuay0zWDU2VU5VWC5tanNcIjtcbmltcG9ydCBcIi4vY2h1bmstNkpPUzc0RFMubWpzXCI7XG5pbXBvcnQge1xuICB1dGlsc19kZWZhdWx0XG59IGZyb20gXCIuL2NodW5rLTdES1JaS0hFLm1qc1wiO1xuaW1wb3J0IHtcbiAgX19uYW1lLFxuICBjb21tb25fZGVmYXVsdCxcbiAgY29uZmlndXJlU3ZnU2l6ZSxcbiAgZ2V0Q29uZmlnMiBhcyBnZXRDb25maWcsXG4gIGxvZ1xufSBmcm9tIFwiLi9jaHVuay02REJGRkhJUC5tanNcIjtcblxuLy8gc3JjL2RpYWdyYW1zL3N0YXRlL3N0YXRlUmVuZGVyZXIuanNcbmltcG9ydCB7IHNlbGVjdCB9IGZyb20gXCJkM1wiO1xuaW1wb3J0IHsgbGF5b3V0IGFzIGRhZ3JlTGF5b3V0IH0gZnJvbSBcImRhZ3JlLWQzLWVzL3NyYy9kYWdyZS9pbmRleC5qc1wiO1xuaW1wb3J0ICogYXMgZ3JhcGhsaWIgZnJvbSBcImRhZ3JlLWQzLWVzL3NyYy9ncmFwaGxpYi9pbmRleC5qc1wiO1xuXG4vLyBzcmMvZGlhZ3JhbXMvc3RhdGUvc2hhcGVzLmpzXG5pbXBvcnQgeyBsaW5lLCBjdXJ2ZUJhc2lzIH0gZnJvbSBcImQzXCI7XG5cbi8vIHNyYy9kaWFncmFtcy9zdGF0ZS9pZC1jYWNoZS5qc1xudmFyIGlkQ2FjaGUgPSB7fTtcbnZhciBzZXQgPSAvKiBAX19QVVJFX18gKi8gX19uYW1lKChrZXksIHZhbCkgPT4ge1xuICBpZENhY2hlW2tleV0gPSB2YWw7XG59LCBcInNldFwiKTtcbnZhciBnZXQgPSAvKiBAX19QVVJFX18gKi8gX19uYW1lKChrKSA9PiBpZENhY2hlW2tdLCBcImdldFwiKTtcbnZhciBrZXlzID0gLyogQF9fUFVSRV9fICovIF9fbmFtZSgoKSA9PiBPYmplY3Qua2V5cyhpZENhY2hlKSwgXCJrZXlzXCIpO1xudmFyIHNpemUgPSAvKiBAX19QVVJFX18gKi8gX19uYW1lKCgpID0+IGtleXMoKS5sZW5ndGgsIFwic2l6ZVwiKTtcbnZhciBpZF9jYWNoZV9kZWZhdWx0ID0ge1xuICBnZXQsXG4gIHNldCxcbiAga2V5cyxcbiAgc2l6ZVxufTtcblxuLy8gc3JjL2RpYWdyYW1zL3N0YXRlL3NoYXBlcy5qc1xudmFyIGRyYXdTdGFydFN0YXRlID0gLyogQF9fUFVSRV9fICovIF9fbmFtZSgoZykgPT4gZy5hcHBlbmQoXCJjaXJjbGVcIikuYXR0cihcImNsYXNzXCIsIFwic3RhcnQtc3RhdGVcIikuYXR0cihcInJcIiwgZ2V0Q29uZmlnKCkuc3RhdGUuc2l6ZVVuaXQpLmF0dHIoXCJjeFwiLCBnZXRDb25maWcoKS5zdGF0ZS5wYWRkaW5nICsgZ2V0Q29uZmlnKCkuc3RhdGUuc2l6ZVVuaXQpLmF0dHIoXCJjeVwiLCBnZXRDb25maWcoKS5zdGF0ZS5wYWRkaW5nICsgZ2V0Q29uZmlnKCkuc3RhdGUuc2l6ZVVuaXQpLCBcImRyYXdTdGFydFN0YXRlXCIpO1xudmFyIGRyYXdEaXZpZGVyID0gLyogQF9fUFVSRV9fICovIF9fbmFtZSgoZykgPT4gZy5hcHBlbmQoXCJsaW5lXCIpLnN0eWxlKFwic3Ryb2tlXCIsIFwiZ3JleVwiKS5zdHlsZShcInN0cm9rZS1kYXNoYXJyYXlcIiwgXCIzXCIpLmF0dHIoXCJ4MVwiLCBnZXRDb25maWcoKS5zdGF0ZS50ZXh0SGVpZ2h0KS5hdHRyKFwiY2xhc3NcIiwgXCJkaXZpZGVyXCIpLmF0dHIoXCJ4MlwiLCBnZXRDb25maWcoKS5zdGF0ZS50ZXh0SGVpZ2h0ICogMikuYXR0cihcInkxXCIsIDApLmF0dHIoXCJ5MlwiLCAwKSwgXCJkcmF3RGl2aWRlclwiKTtcbnZhciBkcmF3U2ltcGxlU3RhdGUgPSAvKiBAX19QVVJFX18gKi8gX19uYW1lKChnLCBzdGF0ZURlZikgPT4ge1xuICBjb25zdCBzdGF0ZSA9IGcuYXBwZW5kKFwidGV4dFwiKS5hdHRyKFwieFwiLCAyICogZ2V0Q29uZmlnKCkuc3RhdGUucGFkZGluZykuYXR0cihcInlcIiwgZ2V0Q29uZmlnKCkuc3RhdGUudGV4dEhlaWdodCArIDIgKiBnZXRDb25maWcoKS5zdGF0ZS5wYWRkaW5nKS5hdHRyKFwiZm9udC1zaXplXCIsIGdldENvbmZpZygpLnN0YXRlLmZvbnRTaXplKS5hdHRyKFwiY2xhc3NcIiwgXCJzdGF0ZS10aXRsZVwiKS50ZXh0KHN0YXRlRGVmLmlkKTtcbiAgY29uc3QgY2xhc3NCb3ggPSBzdGF0ZS5ub2RlKCkuZ2V0QkJveCgpO1xuICBnLmluc2VydChcInJlY3RcIiwgXCI6Zmlyc3QtY2hpbGRcIikuYXR0cihcInhcIiwgZ2V0Q29uZmlnKCkuc3RhdGUucGFkZGluZykuYXR0cihcInlcIiwgZ2V0Q29uZmlnKCkuc3RhdGUucGFkZGluZykuYXR0cihcIndpZHRoXCIsIGNsYXNzQm94LndpZHRoICsgMiAqIGdldENvbmZpZygpLnN0YXRlLnBhZGRpbmcpLmF0dHIoXCJoZWlnaHRcIiwgY2xhc3NCb3guaGVpZ2h0ICsgMiAqIGdldENvbmZpZygpLnN0YXRlLnBhZGRpbmcpLmF0dHIoXCJyeFwiLCBnZXRDb25maWcoKS5zdGF0ZS5yYWRpdXMpO1xuICByZXR1cm4gc3RhdGU7XG59LCBcImRyYXdTaW1wbGVTdGF0ZVwiKTtcbnZhciBkcmF3RGVzY3JTdGF0ZSA9IC8qIEBfX1BVUkVfXyAqLyBfX25hbWUoKGcsIHN0YXRlRGVmKSA9PiB7XG4gIGNvbnN0IGFkZFRzcGFuID0gLyogQF9fUFVSRV9fICovIF9fbmFtZShmdW5jdGlvbih0ZXh0RWwsIHR4dCwgaXNGaXJzdDIpIHtcbiAgICBjb25zdCB0U3BhbiA9IHRleHRFbC5hcHBlbmQoXCJ0c3BhblwiKS5hdHRyKFwieFwiLCAyICogZ2V0Q29uZmlnKCkuc3RhdGUucGFkZGluZykudGV4dCh0eHQpO1xuICAgIGlmICghaXNGaXJzdDIpIHtcbiAgICAgIHRTcGFuLmF0dHIoXCJkeVwiLCBnZXRDb25maWcoKS5zdGF0ZS50ZXh0SGVpZ2h0KTtcbiAgICB9XG4gIH0sIFwiYWRkVHNwYW5cIik7XG4gIGNvbnN0IHRpdGxlID0gZy5hcHBlbmQoXCJ0ZXh0XCIpLmF0dHIoXCJ4XCIsIDIgKiBnZXRDb25maWcoKS5zdGF0ZS5wYWRkaW5nKS5hdHRyKFwieVwiLCBnZXRDb25maWcoKS5zdGF0ZS50ZXh0SGVpZ2h0ICsgMS4zICogZ2V0Q29uZmlnKCkuc3RhdGUucGFkZGluZykuYXR0cihcImZvbnQtc2l6ZVwiLCBnZXRDb25maWcoKS5zdGF0ZS5mb250U2l6ZSkuYXR0cihcImNsYXNzXCIsIFwic3RhdGUtdGl0bGVcIikudGV4dChzdGF0ZURlZi5kZXNjcmlwdGlvbnNbMF0pO1xuICBjb25zdCB0aXRsZUJveCA9IHRpdGxlLm5vZGUoKS5nZXRCQm94KCk7XG4gIGNvbnN0IHRpdGxlSGVpZ2h0ID0gdGl0bGVCb3guaGVpZ2h0O1xuICBjb25zdCBkZXNjcmlwdGlvbiA9IGcuYXBwZW5kKFwidGV4dFwiKS5hdHRyKFwieFwiLCBnZXRDb25maWcoKS5zdGF0ZS5wYWRkaW5nKS5hdHRyKFxuICAgIFwieVwiLFxuICAgIHRpdGxlSGVpZ2h0ICsgZ2V0Q29uZmlnKCkuc3RhdGUucGFkZGluZyAqIDAuNCArIGdldENvbmZpZygpLnN0YXRlLmRpdmlkZXJNYXJnaW4gKyBnZXRDb25maWcoKS5zdGF0ZS50ZXh0SGVpZ2h0XG4gICkuYXR0cihcImNsYXNzXCIsIFwic3RhdGUtZGVzY3JpcHRpb25cIik7XG4gIGxldCBpc0ZpcnN0ID0gdHJ1ZTtcbiAgbGV0IGlzU2Vjb25kID0gdHJ1ZTtcbiAgc3RhdGVEZWYuZGVzY3JpcHRpb25zLmZvckVhY2goZnVuY3Rpb24oZGVzY3IpIHtcbiAgICBpZiAoIWlzRmlyc3QpIHtcbiAgICAgIGFkZFRzcGFuKGRlc2NyaXB0aW9uLCBkZXNjciwgaXNTZWNvbmQpO1xuICAgICAgaXNTZWNvbmQgPSBmYWxzZTtcbiAgICB9XG4gICAgaXNGaXJzdCA9IGZhbHNlO1xuICB9KTtcbiAgY29uc3QgZGVzY3JMaW5lID0gZy5hcHBlbmQoXCJsaW5lXCIpLmF0dHIoXCJ4MVwiLCBnZXRDb25maWcoKS5zdGF0ZS5wYWRkaW5nKS5hdHRyKFwieTFcIiwgZ2V0Q29uZmlnKCkuc3RhdGUucGFkZGluZyArIHRpdGxlSGVpZ2h0ICsgZ2V0Q29uZmlnKCkuc3RhdGUuZGl2aWRlck1hcmdpbiAvIDIpLmF0dHIoXCJ5MlwiLCBnZXRDb25maWcoKS5zdGF0ZS5wYWRkaW5nICsgdGl0bGVIZWlnaHQgKyBnZXRDb25maWcoKS5zdGF0ZS5kaXZpZGVyTWFyZ2luIC8gMikuYXR0cihcImNsYXNzXCIsIFwiZGVzY3ItZGl2aWRlclwiKTtcbiAgY29uc3QgZGVzY3JCb3ggPSBkZXNjcmlwdGlvbi5ub2RlKCkuZ2V0QkJveCgpO1xuICBjb25zdCB3aWR0aCA9IE1hdGgubWF4KGRlc2NyQm94LndpZHRoLCB0aXRsZUJveC53aWR0aCk7XG4gIGRlc2NyTGluZS5hdHRyKFwieDJcIiwgd2lkdGggKyAzICogZ2V0Q29uZmlnKCkuc3RhdGUucGFkZGluZyk7XG4gIGcuaW5zZXJ0KFwicmVjdFwiLCBcIjpmaXJzdC1jaGlsZFwiKS5hdHRyKFwieFwiLCBnZXRDb25maWcoKS5zdGF0ZS5wYWRkaW5nKS5hdHRyKFwieVwiLCBnZXRDb25maWcoKS5zdGF0ZS5wYWRkaW5nKS5hdHRyKFwid2lkdGhcIiwgd2lkdGggKyAyICogZ2V0Q29uZmlnKCkuc3RhdGUucGFkZGluZykuYXR0cihcImhlaWdodFwiLCBkZXNjckJveC5oZWlnaHQgKyB0aXRsZUhlaWdodCArIDIgKiBnZXRDb25maWcoKS5zdGF0ZS5wYWRkaW5nKS5hdHRyKFwicnhcIiwgZ2V0Q29uZmlnKCkuc3RhdGUucmFkaXVzKTtcbiAgcmV0dXJuIGc7XG59LCBcImRyYXdEZXNjclN0YXRlXCIpO1xudmFyIGFkZFRpdGxlQW5kQm94ID0gLyogQF9fUFVSRV9fICovIF9fbmFtZSgoZywgc3RhdGVEZWYsIGFsdEJrZykgPT4ge1xuICBjb25zdCBwYWQgPSBnZXRDb25maWcoKS5zdGF0ZS5wYWRkaW5nO1xuICBjb25zdCBkYmxQYWQgPSAyICogZ2V0Q29uZmlnKCkuc3RhdGUucGFkZGluZztcbiAgY29uc3Qgb3JnQm94ID0gZy5ub2RlKCkuZ2V0QkJveCgpO1xuICBjb25zdCBvcmdXaWR0aCA9IG9yZ0JveC53aWR0aDtcbiAgY29uc3Qgb3JnWCA9IG9yZ0JveC54O1xuICBjb25zdCB0aXRsZSA9IGcuYXBwZW5kKFwidGV4dFwiKS5hdHRyKFwieFwiLCAwKS5hdHRyKFwieVwiLCBnZXRDb25maWcoKS5zdGF0ZS50aXRsZVNoaWZ0KS5hdHRyKFwiZm9udC1zaXplXCIsIGdldENvbmZpZygpLnN0YXRlLmZvbnRTaXplKS5hdHRyKFwiY2xhc3NcIiwgXCJzdGF0ZS10aXRsZVwiKS50ZXh0KHN0YXRlRGVmLmlkKTtcbiAgY29uc3QgdGl0bGVCb3ggPSB0aXRsZS5ub2RlKCkuZ2V0QkJveCgpO1xuICBjb25zdCB0aXRsZVdpZHRoID0gdGl0bGVCb3gud2lkdGggKyBkYmxQYWQ7XG4gIGxldCB3aWR0aCA9IE1hdGgubWF4KHRpdGxlV2lkdGgsIG9yZ1dpZHRoKTtcbiAgaWYgKHdpZHRoID09PSBvcmdXaWR0aCkge1xuICAgIHdpZHRoID0gd2lkdGggKyBkYmxQYWQ7XG4gIH1cbiAgbGV0IHN0YXJ0WDtcbiAgY29uc3QgZ3JhcGhCb3ggPSBnLm5vZGUoKS5nZXRCQm94KCk7XG4gIGlmIChzdGF0ZURlZi5kb2MpIHtcbiAgfVxuICBzdGFydFggPSBvcmdYIC0gcGFkO1xuICBpZiAodGl0bGVXaWR0aCA+IG9yZ1dpZHRoKSB7XG4gICAgc3RhcnRYID0gKG9yZ1dpZHRoIC0gd2lkdGgpIC8gMiArIHBhZDtcbiAgfVxuICBpZiAoTWF0aC5hYnMob3JnWCAtIGdyYXBoQm94LngpIDwgcGFkICYmIHRpdGxlV2lkdGggPiBvcmdXaWR0aCkge1xuICAgIHN0YXJ0WCA9IG9yZ1ggLSAodGl0bGVXaWR0aCAtIG9yZ1dpZHRoKSAvIDI7XG4gIH1cbiAgY29uc3QgbGluZVkgPSAxIC0gZ2V0Q29uZmlnKCkuc3RhdGUudGV4dEhlaWdodDtcbiAgZy5pbnNlcnQoXCJyZWN0XCIsIFwiOmZpcnN0LWNoaWxkXCIpLmF0dHIoXCJ4XCIsIHN0YXJ0WCkuYXR0cihcInlcIiwgbGluZVkpLmF0dHIoXCJjbGFzc1wiLCBhbHRCa2cgPyBcImFsdC1jb21wb3NpdFwiIDogXCJjb21wb3NpdFwiKS5hdHRyKFwid2lkdGhcIiwgd2lkdGgpLmF0dHIoXG4gICAgXCJoZWlnaHRcIixcbiAgICBncmFwaEJveC5oZWlnaHQgKyBnZXRDb25maWcoKS5zdGF0ZS50ZXh0SGVpZ2h0ICsgZ2V0Q29uZmlnKCkuc3RhdGUudGl0bGVTaGlmdCArIDFcbiAgKS5hdHRyKFwicnhcIiwgXCIwXCIpO1xuICB0aXRsZS5hdHRyKFwieFwiLCBzdGFydFggKyBwYWQpO1xuICBpZiAodGl0bGVXaWR0aCA8PSBvcmdXaWR0aCkge1xuICAgIHRpdGxlLmF0dHIoXCJ4XCIsIG9yZ1ggKyAod2lkdGggLSBkYmxQYWQpIC8gMiAtIHRpdGxlV2lkdGggLyAyICsgcGFkKTtcbiAgfVxuICBnLmluc2VydChcInJlY3RcIiwgXCI6Zmlyc3QtY2hpbGRcIikuYXR0cihcInhcIiwgc3RhcnRYKS5hdHRyKFxuICAgIFwieVwiLFxuICAgIGdldENvbmZpZygpLnN0YXRlLnRpdGxlU2hpZnQgLSBnZXRDb25maWcoKS5zdGF0ZS50ZXh0SGVpZ2h0IC0gZ2V0Q29uZmlnKCkuc3RhdGUucGFkZGluZ1xuICApLmF0dHIoXCJ3aWR0aFwiLCB3aWR0aCkuYXR0cihcImhlaWdodFwiLCBnZXRDb25maWcoKS5zdGF0ZS50ZXh0SGVpZ2h0ICogMykuYXR0cihcInJ4XCIsIGdldENvbmZpZygpLnN0YXRlLnJhZGl1cyk7XG4gIGcuaW5zZXJ0KFwicmVjdFwiLCBcIjpmaXJzdC1jaGlsZFwiKS5hdHRyKFwieFwiLCBzdGFydFgpLmF0dHIoXG4gICAgXCJ5XCIsXG4gICAgZ2V0Q29uZmlnKCkuc3RhdGUudGl0bGVTaGlmdCAtIGdldENvbmZpZygpLnN0YXRlLnRleHRIZWlnaHQgLSBnZXRDb25maWcoKS5zdGF0ZS5wYWRkaW5nXG4gICkuYXR0cihcIndpZHRoXCIsIHdpZHRoKS5hdHRyKFwiaGVpZ2h0XCIsIGdyYXBoQm94LmhlaWdodCArIDMgKyAyICogZ2V0Q29uZmlnKCkuc3RhdGUudGV4dEhlaWdodCkuYXR0cihcInJ4XCIsIGdldENvbmZpZygpLnN0YXRlLnJhZGl1cyk7XG4gIHJldHVybiBnO1xufSwgXCJhZGRUaXRsZUFuZEJveFwiKTtcbnZhciBkcmF3RW5kU3RhdGUgPSAvKiBAX19QVVJFX18gKi8gX19uYW1lKChnKSA9PiB7XG4gIGcuYXBwZW5kKFwiY2lyY2xlXCIpLmF0dHIoXCJjbGFzc1wiLCBcImVuZC1zdGF0ZS1vdXRlclwiKS5hdHRyKFwiclwiLCBnZXRDb25maWcoKS5zdGF0ZS5zaXplVW5pdCArIGdldENvbmZpZygpLnN0YXRlLm1pbmlQYWRkaW5nKS5hdHRyKFxuICAgIFwiY3hcIixcbiAgICBnZXRDb25maWcoKS5zdGF0ZS5wYWRkaW5nICsgZ2V0Q29uZmlnKCkuc3RhdGUuc2l6ZVVuaXQgKyBnZXRDb25maWcoKS5zdGF0ZS5taW5pUGFkZGluZ1xuICApLmF0dHIoXG4gICAgXCJjeVwiLFxuICAgIGdldENvbmZpZygpLnN0YXRlLnBhZGRpbmcgKyBnZXRDb25maWcoKS5zdGF0ZS5zaXplVW5pdCArIGdldENvbmZpZygpLnN0YXRlLm1pbmlQYWRkaW5nXG4gICk7XG4gIHJldHVybiBnLmFwcGVuZChcImNpcmNsZVwiKS5hdHRyKFwiY2xhc3NcIiwgXCJlbmQtc3RhdGUtaW5uZXJcIikuYXR0cihcInJcIiwgZ2V0Q29uZmlnKCkuc3RhdGUuc2l6ZVVuaXQpLmF0dHIoXCJjeFwiLCBnZXRDb25maWcoKS5zdGF0ZS5wYWRkaW5nICsgZ2V0Q29uZmlnKCkuc3RhdGUuc2l6ZVVuaXQgKyAyKS5hdHRyKFwiY3lcIiwgZ2V0Q29uZmlnKCkuc3RhdGUucGFkZGluZyArIGdldENvbmZpZygpLnN0YXRlLnNpemVVbml0ICsgMik7XG59LCBcImRyYXdFbmRTdGF0ZVwiKTtcbnZhciBkcmF3Rm9ya0pvaW5TdGF0ZSA9IC8qIEBfX1BVUkVfXyAqLyBfX25hbWUoKGcsIHN0YXRlRGVmKSA9PiB7XG4gIGxldCB3aWR0aCA9IGdldENvbmZpZygpLnN0YXRlLmZvcmtXaWR0aDtcbiAgbGV0IGhlaWdodCA9IGdldENvbmZpZygpLnN0YXRlLmZvcmtIZWlnaHQ7XG4gIGlmIChzdGF0ZURlZi5wYXJlbnRJZCkge1xuICAgIGxldCB0bXAgPSB3aWR0aDtcbiAgICB3aWR0aCA9IGhlaWdodDtcbiAgICBoZWlnaHQgPSB0bXA7XG4gIH1cbiAgcmV0dXJuIGcuYXBwZW5kKFwicmVjdFwiKS5zdHlsZShcInN0cm9rZVwiLCBcImJsYWNrXCIpLnN0eWxlKFwiZmlsbFwiLCBcImJsYWNrXCIpLmF0dHIoXCJ3aWR0aFwiLCB3aWR0aCkuYXR0cihcImhlaWdodFwiLCBoZWlnaHQpLmF0dHIoXCJ4XCIsIGdldENvbmZpZygpLnN0YXRlLnBhZGRpbmcpLmF0dHIoXCJ5XCIsIGdldENvbmZpZygpLnN0YXRlLnBhZGRpbmcpO1xufSwgXCJkcmF3Rm9ya0pvaW5TdGF0ZVwiKTtcbnZhciBfZHJhd0xvbmdUZXh0ID0gLyogQF9fUFVSRV9fICovIF9fbmFtZSgoX3RleHQsIHgsIHksIGcpID0+IHtcbiAgbGV0IHRleHRIZWlnaHQgPSAwO1xuICBjb25zdCB0ZXh0RWxlbSA9IGcuYXBwZW5kKFwidGV4dFwiKTtcbiAgdGV4dEVsZW0uc3R5bGUoXCJ0ZXh0LWFuY2hvclwiLCBcInN0YXJ0XCIpO1xuICB0ZXh0RWxlbS5hdHRyKFwiY2xhc3NcIiwgXCJub3RlVGV4dFwiKTtcbiAgbGV0IHRleHQgPSBfdGV4dC5yZXBsYWNlKC9cXHJcXG4vZywgXCI8YnIvPlwiKTtcbiAgdGV4dCA9IHRleHQucmVwbGFjZSgvXFxuL2csIFwiPGJyLz5cIik7XG4gIGNvbnN0IGxpbmVzID0gdGV4dC5zcGxpdChjb21tb25fZGVmYXVsdC5saW5lQnJlYWtSZWdleCk7XG4gIGxldCB0SGVpZ2h0ID0gMS4yNSAqIGdldENvbmZpZygpLnN0YXRlLm5vdGVNYXJnaW47XG4gIGZvciAoY29uc3QgbGluZTIgb2YgbGluZXMpIHtcbiAgICBjb25zdCB0eHQgPSBsaW5lMi50cmltKCk7XG4gICAgaWYgKHR4dC5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCBzcGFuID0gdGV4dEVsZW0uYXBwZW5kKFwidHNwYW5cIik7XG4gICAgICBzcGFuLnRleHQodHh0KTtcbiAgICAgIGlmICh0SGVpZ2h0ID09PSAwKSB7XG4gICAgICAgIGNvbnN0IHRleHRCb3VuZHMgPSBzcGFuLm5vZGUoKS5nZXRCQm94KCk7XG4gICAgICAgIHRIZWlnaHQgKz0gdGV4dEJvdW5kcy5oZWlnaHQ7XG4gICAgICB9XG4gICAgICB0ZXh0SGVpZ2h0ICs9IHRIZWlnaHQ7XG4gICAgICBzcGFuLmF0dHIoXCJ4XCIsIHggKyBnZXRDb25maWcoKS5zdGF0ZS5ub3RlTWFyZ2luKTtcbiAgICAgIHNwYW4uYXR0cihcInlcIiwgeSArIHRleHRIZWlnaHQgKyAxLjI1ICogZ2V0Q29uZmlnKCkuc3RhdGUubm90ZU1hcmdpbik7XG4gICAgfVxuICB9XG4gIHJldHVybiB7IHRleHRXaWR0aDogdGV4dEVsZW0ubm9kZSgpLmdldEJCb3goKS53aWR0aCwgdGV4dEhlaWdodCB9O1xufSwgXCJfZHJhd0xvbmdUZXh0XCIpO1xudmFyIGRyYXdOb3RlID0gLyogQF9fUFVSRV9fICovIF9fbmFtZSgodGV4dCwgZykgPT4ge1xuICBnLmF0dHIoXCJjbGFzc1wiLCBcInN0YXRlLW5vdGVcIik7XG4gIGNvbnN0IG5vdGUgPSBnLmFwcGVuZChcInJlY3RcIikuYXR0cihcInhcIiwgMCkuYXR0cihcInlcIiwgZ2V0Q29uZmlnKCkuc3RhdGUucGFkZGluZyk7XG4gIGNvbnN0IHJlY3RFbGVtID0gZy5hcHBlbmQoXCJnXCIpO1xuICBjb25zdCB7IHRleHRXaWR0aCwgdGV4dEhlaWdodCB9ID0gX2RyYXdMb25nVGV4dCh0ZXh0LCAwLCAwLCByZWN0RWxlbSk7XG4gIG5vdGUuYXR0cihcImhlaWdodFwiLCB0ZXh0SGVpZ2h0ICsgMiAqIGdldENvbmZpZygpLnN0YXRlLm5vdGVNYXJnaW4pO1xuICBub3RlLmF0dHIoXCJ3aWR0aFwiLCB0ZXh0V2lkdGggKyBnZXRDb25maWcoKS5zdGF0ZS5ub3RlTWFyZ2luICogMik7XG4gIHJldHVybiBub3RlO1xufSwgXCJkcmF3Tm90ZVwiKTtcbnZhciBkcmF3U3RhdGUgPSAvKiBAX19QVVJFX18gKi8gX19uYW1lKGZ1bmN0aW9uKGVsZW0sIHN0YXRlRGVmKSB7XG4gIGNvbnN0IGlkID0gc3RhdGVEZWYuaWQ7XG4gIGNvbnN0IHN0YXRlSW5mbyA9IHtcbiAgICBpZCxcbiAgICBsYWJlbDogc3RhdGVEZWYuaWQsXG4gICAgd2lkdGg6IDAsXG4gICAgaGVpZ2h0OiAwXG4gIH07XG4gIGNvbnN0IGcgPSBlbGVtLmFwcGVuZChcImdcIikuYXR0cihcImlkXCIsIGlkKS5hdHRyKFwiY2xhc3NcIiwgXCJzdGF0ZUdyb3VwXCIpO1xuICBpZiAoc3RhdGVEZWYudHlwZSA9PT0gXCJzdGFydFwiKSB7XG4gICAgZHJhd1N0YXJ0U3RhdGUoZyk7XG4gIH1cbiAgaWYgKHN0YXRlRGVmLnR5cGUgPT09IFwiZW5kXCIpIHtcbiAgICBkcmF3RW5kU3RhdGUoZyk7XG4gIH1cbiAgaWYgKHN0YXRlRGVmLnR5cGUgPT09IFwiZm9ya1wiIHx8IHN0YXRlRGVmLnR5cGUgPT09IFwiam9pblwiKSB7XG4gICAgZHJhd0ZvcmtKb2luU3RhdGUoZywgc3RhdGVEZWYpO1xuICB9XG4gIGlmIChzdGF0ZURlZi50eXBlID09PSBcIm5vdGVcIikge1xuICAgIGRyYXdOb3RlKHN0YXRlRGVmLm5vdGUudGV4dCwgZyk7XG4gIH1cbiAgaWYgKHN0YXRlRGVmLnR5cGUgPT09IFwiZGl2aWRlclwiKSB7XG4gICAgZHJhd0RpdmlkZXIoZyk7XG4gIH1cbiAgaWYgKHN0YXRlRGVmLnR5cGUgPT09IFwiZGVmYXVsdFwiICYmIHN0YXRlRGVmLmRlc2NyaXB0aW9ucy5sZW5ndGggPT09IDApIHtcbiAgICBkcmF3U2ltcGxlU3RhdGUoZywgc3RhdGVEZWYpO1xuICB9XG4gIGlmIChzdGF0ZURlZi50eXBlID09PSBcImRlZmF1bHRcIiAmJiBzdGF0ZURlZi5kZXNjcmlwdGlvbnMubGVuZ3RoID4gMCkge1xuICAgIGRyYXdEZXNjclN0YXRlKGcsIHN0YXRlRGVmKTtcbiAgfVxuICBjb25zdCBzdGF0ZUJveCA9IGcubm9kZSgpLmdldEJCb3goKTtcbiAgc3RhdGVJbmZvLndpZHRoID0gc3RhdGVCb3gud2lkdGggKyAyICogZ2V0Q29uZmlnKCkuc3RhdGUucGFkZGluZztcbiAgc3RhdGVJbmZvLmhlaWdodCA9IHN0YXRlQm94LmhlaWdodCArIDIgKiBnZXRDb25maWcoKS5zdGF0ZS5wYWRkaW5nO1xuICBpZF9jYWNoZV9kZWZhdWx0LnNldChpZCwgc3RhdGVJbmZvKTtcbiAgcmV0dXJuIHN0YXRlSW5mbztcbn0sIFwiZHJhd1N0YXRlXCIpO1xudmFyIGVkZ2VDb3VudCA9IDA7XG52YXIgZHJhd0VkZ2UgPSAvKiBAX19QVVJFX18gKi8gX19uYW1lKGZ1bmN0aW9uKGVsZW0sIHBhdGgsIHJlbGF0aW9uKSB7XG4gIGNvbnN0IGdldFJlbGF0aW9uVHlwZSA9IC8qIEBfX1BVUkVfXyAqLyBfX25hbWUoZnVuY3Rpb24odHlwZSkge1xuICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgY2FzZSBzdGF0ZURiX2RlZmF1bHQucmVsYXRpb25UeXBlLkFHR1JFR0FUSU9OOlxuICAgICAgICByZXR1cm4gXCJhZ2dyZWdhdGlvblwiO1xuICAgICAgY2FzZSBzdGF0ZURiX2RlZmF1bHQucmVsYXRpb25UeXBlLkVYVEVOU0lPTjpcbiAgICAgICAgcmV0dXJuIFwiZXh0ZW5zaW9uXCI7XG4gICAgICBjYXNlIHN0YXRlRGJfZGVmYXVsdC5yZWxhdGlvblR5cGUuQ09NUE9TSVRJT046XG4gICAgICAgIHJldHVybiBcImNvbXBvc2l0aW9uXCI7XG4gICAgICBjYXNlIHN0YXRlRGJfZGVmYXVsdC5yZWxhdGlvblR5cGUuREVQRU5ERU5DWTpcbiAgICAgICAgcmV0dXJuIFwiZGVwZW5kZW5jeVwiO1xuICAgIH1cbiAgfSwgXCJnZXRSZWxhdGlvblR5cGVcIik7XG4gIHBhdGgucG9pbnRzID0gcGF0aC5wb2ludHMuZmlsdGVyKChwKSA9PiAhTnVtYmVyLmlzTmFOKHAueSkpO1xuICBjb25zdCBsaW5lRGF0YSA9IHBhdGgucG9pbnRzO1xuICBjb25zdCBsaW5lRnVuY3Rpb24gPSBsaW5lKCkueChmdW5jdGlvbihkKSB7XG4gICAgcmV0dXJuIGQueDtcbiAgfSkueShmdW5jdGlvbihkKSB7XG4gICAgcmV0dXJuIGQueTtcbiAgfSkuY3VydmUoY3VydmVCYXNpcyk7XG4gIGNvbnN0IHN2Z1BhdGggPSBlbGVtLmFwcGVuZChcInBhdGhcIikuYXR0cihcImRcIiwgbGluZUZ1bmN0aW9uKGxpbmVEYXRhKSkuYXR0cihcImlkXCIsIFwiZWRnZVwiICsgZWRnZUNvdW50KS5hdHRyKFwiY2xhc3NcIiwgXCJ0cmFuc2l0aW9uXCIpO1xuICBsZXQgdXJsID0gXCJcIjtcbiAgaWYgKGdldENvbmZpZygpLnN0YXRlLmFycm93TWFya2VyQWJzb2x1dGUpIHtcbiAgICB1cmwgPSB3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wgKyBcIi8vXCIgKyB3aW5kb3cubG9jYXRpb24uaG9zdCArIHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSArIHdpbmRvdy5sb2NhdGlvbi5zZWFyY2g7XG4gICAgdXJsID0gdXJsLnJlcGxhY2UoL1xcKC9nLCBcIlxcXFwoXCIpO1xuICAgIHVybCA9IHVybC5yZXBsYWNlKC9cXCkvZywgXCJcXFxcKVwiKTtcbiAgfVxuICBzdmdQYXRoLmF0dHIoXG4gICAgXCJtYXJrZXItZW5kXCIsXG4gICAgXCJ1cmwoXCIgKyB1cmwgKyBcIiNcIiArIGdldFJlbGF0aW9uVHlwZShzdGF0ZURiX2RlZmF1bHQucmVsYXRpb25UeXBlLkRFUEVOREVOQ1kpICsgXCJFbmQpXCJcbiAgKTtcbiAgaWYgKHJlbGF0aW9uLnRpdGxlICE9PSB2b2lkIDApIHtcbiAgICBjb25zdCBsYWJlbCA9IGVsZW0uYXBwZW5kKFwiZ1wiKS5hdHRyKFwiY2xhc3NcIiwgXCJzdGF0ZUxhYmVsXCIpO1xuICAgIGNvbnN0IHsgeCwgeSB9ID0gdXRpbHNfZGVmYXVsdC5jYWxjTGFiZWxQb3NpdGlvbihwYXRoLnBvaW50cyk7XG4gICAgY29uc3Qgcm93cyA9IGNvbW1vbl9kZWZhdWx0LmdldFJvd3MocmVsYXRpb24udGl0bGUpO1xuICAgIGxldCB0aXRsZUhlaWdodCA9IDA7XG4gICAgY29uc3QgdGl0bGVSb3dzID0gW107XG4gICAgbGV0IG1heFdpZHRoID0gMDtcbiAgICBsZXQgbWluWCA9IDA7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gcm93cy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgdGl0bGUgPSBsYWJlbC5hcHBlbmQoXCJ0ZXh0XCIpLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKS50ZXh0KHJvd3NbaV0pLmF0dHIoXCJ4XCIsIHgpLmF0dHIoXCJ5XCIsIHkgKyB0aXRsZUhlaWdodCk7XG4gICAgICBjb25zdCBib3VuZHNUbXAgPSB0aXRsZS5ub2RlKCkuZ2V0QkJveCgpO1xuICAgICAgbWF4V2lkdGggPSBNYXRoLm1heChtYXhXaWR0aCwgYm91bmRzVG1wLndpZHRoKTtcbiAgICAgIG1pblggPSBNYXRoLm1pbihtaW5YLCBib3VuZHNUbXAueCk7XG4gICAgICBsb2cuaW5mbyhib3VuZHNUbXAueCwgeCwgeSArIHRpdGxlSGVpZ2h0KTtcbiAgICAgIGlmICh0aXRsZUhlaWdodCA9PT0gMCkge1xuICAgICAgICBjb25zdCB0aXRsZUJveCA9IHRpdGxlLm5vZGUoKS5nZXRCQm94KCk7XG4gICAgICAgIHRpdGxlSGVpZ2h0ID0gdGl0bGVCb3guaGVpZ2h0O1xuICAgICAgICBsb2cuaW5mbyhcIlRpdGxlIGhlaWdodFwiLCB0aXRsZUhlaWdodCwgeSk7XG4gICAgICB9XG4gICAgICB0aXRsZVJvd3MucHVzaCh0aXRsZSk7XG4gICAgfVxuICAgIGxldCBib3hIZWlnaHQgPSB0aXRsZUhlaWdodCAqIHJvd3MubGVuZ3RoO1xuICAgIGlmIChyb3dzLmxlbmd0aCA+IDEpIHtcbiAgICAgIGNvbnN0IGhlaWdodEFkaiA9IChyb3dzLmxlbmd0aCAtIDEpICogdGl0bGVIZWlnaHQgKiAwLjU7XG4gICAgICB0aXRsZVJvd3MuZm9yRWFjaCgodGl0bGUsIGkpID0+IHRpdGxlLmF0dHIoXCJ5XCIsIHkgKyBpICogdGl0bGVIZWlnaHQgLSBoZWlnaHRBZGopKTtcbiAgICAgIGJveEhlaWdodCA9IHRpdGxlSGVpZ2h0ICogcm93cy5sZW5ndGg7XG4gICAgfVxuICAgIGNvbnN0IGJvdW5kcyA9IGxhYmVsLm5vZGUoKS5nZXRCQm94KCk7XG4gICAgbGFiZWwuaW5zZXJ0KFwicmVjdFwiLCBcIjpmaXJzdC1jaGlsZFwiKS5hdHRyKFwiY2xhc3NcIiwgXCJib3hcIikuYXR0cihcInhcIiwgeCAtIG1heFdpZHRoIC8gMiAtIGdldENvbmZpZygpLnN0YXRlLnBhZGRpbmcgLyAyKS5hdHRyKFwieVwiLCB5IC0gYm94SGVpZ2h0IC8gMiAtIGdldENvbmZpZygpLnN0YXRlLnBhZGRpbmcgLyAyIC0gMy41KS5hdHRyKFwid2lkdGhcIiwgbWF4V2lkdGggKyBnZXRDb25maWcoKS5zdGF0ZS5wYWRkaW5nKS5hdHRyKFwiaGVpZ2h0XCIsIGJveEhlaWdodCArIGdldENvbmZpZygpLnN0YXRlLnBhZGRpbmcpO1xuICAgIGxvZy5pbmZvKGJvdW5kcyk7XG4gIH1cbiAgZWRnZUNvdW50Kys7XG59LCBcImRyYXdFZGdlXCIpO1xuXG4vLyBzcmMvZGlhZ3JhbXMvc3RhdGUvc3RhdGVSZW5kZXJlci5qc1xudmFyIGNvbmY7XG52YXIgdHJhbnNmb3JtYXRpb25Mb2cgPSB7fTtcbnZhciBzZXRDb25mID0gLyogQF9fUFVSRV9fICovIF9fbmFtZShmdW5jdGlvbigpIHtcbn0sIFwic2V0Q29uZlwiKTtcbnZhciBpbnNlcnRNYXJrZXJzID0gLyogQF9fUFVSRV9fICovIF9fbmFtZShmdW5jdGlvbihlbGVtKSB7XG4gIGVsZW0uYXBwZW5kKFwiZGVmc1wiKS5hcHBlbmQoXCJtYXJrZXJcIikuYXR0cihcImlkXCIsIFwiZGVwZW5kZW5jeUVuZFwiKS5hdHRyKFwicmVmWFwiLCAxOSkuYXR0cihcInJlZllcIiwgNykuYXR0cihcIm1hcmtlcldpZHRoXCIsIDIwKS5hdHRyKFwibWFya2VySGVpZ2h0XCIsIDI4KS5hdHRyKFwib3JpZW50XCIsIFwiYXV0b1wiKS5hcHBlbmQoXCJwYXRoXCIpLmF0dHIoXCJkXCIsIFwiTSAxOSw3IEw5LDEzIEwxNCw3IEw5LDEgWlwiKTtcbn0sIFwiaW5zZXJ0TWFya2Vyc1wiKTtcbnZhciBkcmF3ID0gLyogQF9fUFVSRV9fICovIF9fbmFtZShmdW5jdGlvbih0ZXh0LCBpZCwgX3ZlcnNpb24sIGRpYWdPYmopIHtcbiAgY29uZiA9IGdldENvbmZpZygpLnN0YXRlO1xuICBjb25zdCBzZWN1cml0eUxldmVsID0gZ2V0Q29uZmlnKCkuc2VjdXJpdHlMZXZlbDtcbiAgbGV0IHNhbmRib3hFbGVtZW50O1xuICBpZiAoc2VjdXJpdHlMZXZlbCA9PT0gXCJzYW5kYm94XCIpIHtcbiAgICBzYW5kYm94RWxlbWVudCA9IHNlbGVjdChcIiNpXCIgKyBpZCk7XG4gIH1cbiAgY29uc3Qgcm9vdCA9IHNlY3VyaXR5TGV2ZWwgPT09IFwic2FuZGJveFwiID8gc2VsZWN0KHNhbmRib3hFbGVtZW50Lm5vZGVzKClbMF0uY29udGVudERvY3VtZW50LmJvZHkpIDogc2VsZWN0KFwiYm9keVwiKTtcbiAgY29uc3QgZG9jID0gc2VjdXJpdHlMZXZlbCA9PT0gXCJzYW5kYm94XCIgPyBzYW5kYm94RWxlbWVudC5ub2RlcygpWzBdLmNvbnRlbnREb2N1bWVudCA6IGRvY3VtZW50O1xuICBsb2cuZGVidWcoXCJSZW5kZXJpbmcgZGlhZ3JhbSBcIiArIHRleHQpO1xuICBjb25zdCBkaWFncmFtMiA9IHJvb3Quc2VsZWN0KGBbaWQ9JyR7aWR9J11gKTtcbiAgaW5zZXJ0TWFya2VycyhkaWFncmFtMik7XG4gIGNvbnN0IHJvb3REb2MgPSBkaWFnT2JqLmRiLmdldFJvb3REb2MoKTtcbiAgcmVuZGVyRG9jKHJvb3REb2MsIGRpYWdyYW0yLCB2b2lkIDAsIGZhbHNlLCByb290LCBkb2MsIGRpYWdPYmopO1xuICBjb25zdCBwYWRkaW5nID0gY29uZi5wYWRkaW5nO1xuICBjb25zdCBib3VuZHMgPSBkaWFncmFtMi5ub2RlKCkuZ2V0QkJveCgpO1xuICBjb25zdCB3aWR0aCA9IGJvdW5kcy53aWR0aCArIHBhZGRpbmcgKiAyO1xuICBjb25zdCBoZWlnaHQgPSBib3VuZHMuaGVpZ2h0ICsgcGFkZGluZyAqIDI7XG4gIGNvbnN0IHN2Z1dpZHRoID0gd2lkdGggKiAxLjc1O1xuICBjb25maWd1cmVTdmdTaXplKGRpYWdyYW0yLCBoZWlnaHQsIHN2Z1dpZHRoLCBjb25mLnVzZU1heFdpZHRoKTtcbiAgZGlhZ3JhbTIuYXR0cihcbiAgICBcInZpZXdCb3hcIixcbiAgICBgJHtib3VuZHMueCAtIGNvbmYucGFkZGluZ30gICR7Ym91bmRzLnkgLSBjb25mLnBhZGRpbmd9IGAgKyB3aWR0aCArIFwiIFwiICsgaGVpZ2h0XG4gICk7XG59LCBcImRyYXdcIik7XG52YXIgZ2V0TGFiZWxXaWR0aCA9IC8qIEBfX1BVUkVfXyAqLyBfX25hbWUoKHRleHQpID0+IHtcbiAgcmV0dXJuIHRleHQgPyB0ZXh0Lmxlbmd0aCAqIGNvbmYuZm9udFNpemVGYWN0b3IgOiAxO1xufSwgXCJnZXRMYWJlbFdpZHRoXCIpO1xudmFyIHJlbmRlckRvYyA9IC8qIEBfX1BVUkVfXyAqLyBfX25hbWUoKGRvYywgZGlhZ3JhbTIsIHBhcmVudElkLCBhbHRCa2csIHJvb3QsIGRvbURvY3VtZW50LCBkaWFnT2JqKSA9PiB7XG4gIGNvbnN0IGdyYXBoID0gbmV3IGdyYXBobGliLkdyYXBoKHtcbiAgICBjb21wb3VuZDogdHJ1ZSxcbiAgICBtdWx0aWdyYXBoOiB0cnVlXG4gIH0pO1xuICBsZXQgaTtcbiAgbGV0IGVkZ2VGcmVlRG9jID0gdHJ1ZTtcbiAgZm9yIChpID0gMDsgaSA8IGRvYy5sZW5ndGg7IGkrKykge1xuICAgIGlmIChkb2NbaV0uc3RtdCA9PT0gXCJyZWxhdGlvblwiKSB7XG4gICAgICBlZGdlRnJlZURvYyA9IGZhbHNlO1xuICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG4gIGlmIChwYXJlbnRJZCkge1xuICAgIGdyYXBoLnNldEdyYXBoKHtcbiAgICAgIHJhbmtkaXI6IFwiTFJcIixcbiAgICAgIG11bHRpZ3JhcGg6IHRydWUsXG4gICAgICBjb21wb3VuZDogdHJ1ZSxcbiAgICAgIC8vIGFjeWNsaWNlcjogJ2dyZWVkeScsXG4gICAgICByYW5rZXI6IFwidGlnaHQtdHJlZVwiLFxuICAgICAgcmFua3NlcDogZWRnZUZyZWVEb2MgPyAxIDogY29uZi5lZGdlTGVuZ3RoRmFjdG9yLFxuICAgICAgbm9kZVNlcDogZWRnZUZyZWVEb2MgPyAxIDogNTAsXG4gICAgICBpc011bHRpR3JhcGg6IHRydWVcbiAgICAgIC8vIHJhbmtzZXA6IDUsXG4gICAgICAvLyBub2Rlc2VwOiAxXG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgZ3JhcGguc2V0R3JhcGgoe1xuICAgICAgcmFua2RpcjogXCJUQlwiLFxuICAgICAgbXVsdGlncmFwaDogdHJ1ZSxcbiAgICAgIGNvbXBvdW5kOiB0cnVlLFxuICAgICAgLy8gaXNDb21wb3VuZDogdHJ1ZSxcbiAgICAgIC8vIGFjeWNsaWNlcjogJ2dyZWVkeScsXG4gICAgICAvLyByYW5rZXI6ICdsb25nZXN0LXBhdGgnXG4gICAgICByYW5rc2VwOiBlZGdlRnJlZURvYyA/IDEgOiBjb25mLmVkZ2VMZW5ndGhGYWN0b3IsXG4gICAgICBub2RlU2VwOiBlZGdlRnJlZURvYyA/IDEgOiA1MCxcbiAgICAgIHJhbmtlcjogXCJ0aWdodC10cmVlXCIsXG4gICAgICAvLyByYW5rZXI6ICduZXR3b3JrLXNpbXBsZXgnXG4gICAgICBpc011bHRpR3JhcGg6IHRydWVcbiAgICB9KTtcbiAgfVxuICBncmFwaC5zZXREZWZhdWx0RWRnZUxhYmVsKGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB7fTtcbiAgfSk7XG4gIGRpYWdPYmouZGIuZXh0cmFjdChkb2MpO1xuICBjb25zdCBzdGF0ZXMgPSBkaWFnT2JqLmRiLmdldFN0YXRlcygpO1xuICBjb25zdCByZWxhdGlvbnMgPSBkaWFnT2JqLmRiLmdldFJlbGF0aW9ucygpO1xuICBjb25zdCBrZXlzMiA9IE9iamVjdC5rZXlzKHN0YXRlcyk7XG4gIGxldCBmaXJzdCA9IHRydWU7XG4gIGZvciAoY29uc3Qga2V5IG9mIGtleXMyKSB7XG4gICAgY29uc3Qgc3RhdGVEZWYgPSBzdGF0ZXNba2V5XTtcbiAgICBpZiAocGFyZW50SWQpIHtcbiAgICAgIHN0YXRlRGVmLnBhcmVudElkID0gcGFyZW50SWQ7XG4gICAgfVxuICAgIGxldCBub2RlO1xuICAgIGlmIChzdGF0ZURlZi5kb2MpIHtcbiAgICAgIGxldCBzdWIgPSBkaWFncmFtMi5hcHBlbmQoXCJnXCIpLmF0dHIoXCJpZFwiLCBzdGF0ZURlZi5pZCkuYXR0cihcImNsYXNzXCIsIFwic3RhdGVHcm91cFwiKTtcbiAgICAgIG5vZGUgPSByZW5kZXJEb2Moc3RhdGVEZWYuZG9jLCBzdWIsIHN0YXRlRGVmLmlkLCAhYWx0QmtnLCByb290LCBkb21Eb2N1bWVudCwgZGlhZ09iaik7XG4gICAgICBpZiAoZmlyc3QpIHtcbiAgICAgICAgc3ViID0gYWRkVGl0bGVBbmRCb3goc3ViLCBzdGF0ZURlZiwgYWx0QmtnKTtcbiAgICAgICAgbGV0IGJveEJvdW5kcyA9IHN1Yi5ub2RlKCkuZ2V0QkJveCgpO1xuICAgICAgICBub2RlLndpZHRoID0gYm94Qm91bmRzLndpZHRoO1xuICAgICAgICBub2RlLmhlaWdodCA9IGJveEJvdW5kcy5oZWlnaHQgKyBjb25mLnBhZGRpbmcgLyAyO1xuICAgICAgICB0cmFuc2Zvcm1hdGlvbkxvZ1tzdGF0ZURlZi5pZF0gPSB7IHk6IGNvbmYuY29tcG9zaXRUaXRsZVNpemUgfTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxldCBib3hCb3VuZHMgPSBzdWIubm9kZSgpLmdldEJCb3goKTtcbiAgICAgICAgbm9kZS53aWR0aCA9IGJveEJvdW5kcy53aWR0aDtcbiAgICAgICAgbm9kZS5oZWlnaHQgPSBib3hCb3VuZHMuaGVpZ2h0O1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBub2RlID0gZHJhd1N0YXRlKGRpYWdyYW0yLCBzdGF0ZURlZiwgZ3JhcGgpO1xuICAgIH1cbiAgICBpZiAoc3RhdGVEZWYubm90ZSkge1xuICAgICAgY29uc3Qgbm90ZURlZiA9IHtcbiAgICAgICAgZGVzY3JpcHRpb25zOiBbXSxcbiAgICAgICAgaWQ6IHN0YXRlRGVmLmlkICsgXCItbm90ZVwiLFxuICAgICAgICBub3RlOiBzdGF0ZURlZi5ub3RlLFxuICAgICAgICB0eXBlOiBcIm5vdGVcIlxuICAgICAgfTtcbiAgICAgIGNvbnN0IG5vdGUgPSBkcmF3U3RhdGUoZGlhZ3JhbTIsIG5vdGVEZWYsIGdyYXBoKTtcbiAgICAgIGlmIChzdGF0ZURlZi5ub3RlLnBvc2l0aW9uID09PSBcImxlZnQgb2ZcIikge1xuICAgICAgICBncmFwaC5zZXROb2RlKG5vZGUuaWQgKyBcIi1ub3RlXCIsIG5vdGUpO1xuICAgICAgICBncmFwaC5zZXROb2RlKG5vZGUuaWQsIG5vZGUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZ3JhcGguc2V0Tm9kZShub2RlLmlkLCBub2RlKTtcbiAgICAgICAgZ3JhcGguc2V0Tm9kZShub2RlLmlkICsgXCItbm90ZVwiLCBub3RlKTtcbiAgICAgIH1cbiAgICAgIGdyYXBoLnNldFBhcmVudChub2RlLmlkLCBub2RlLmlkICsgXCItZ3JvdXBcIik7XG4gICAgICBncmFwaC5zZXRQYXJlbnQobm9kZS5pZCArIFwiLW5vdGVcIiwgbm9kZS5pZCArIFwiLWdyb3VwXCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICBncmFwaC5zZXROb2RlKG5vZGUuaWQsIG5vZGUpO1xuICAgIH1cbiAgfVxuICBsb2cuZGVidWcoXCJDb3VudD1cIiwgZ3JhcGgubm9kZUNvdW50KCksIGdyYXBoKTtcbiAgbGV0IGNudCA9IDA7XG4gIHJlbGF0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uKHJlbGF0aW9uKSB7XG4gICAgY250Kys7XG4gICAgbG9nLmRlYnVnKFwiU2V0dGluZyBlZGdlXCIsIHJlbGF0aW9uKTtcbiAgICBncmFwaC5zZXRFZGdlKFxuICAgICAgcmVsYXRpb24uaWQxLFxuICAgICAgcmVsYXRpb24uaWQyLFxuICAgICAge1xuICAgICAgICByZWxhdGlvbixcbiAgICAgICAgd2lkdGg6IGdldExhYmVsV2lkdGgocmVsYXRpb24udGl0bGUpLFxuICAgICAgICBoZWlnaHQ6IGNvbmYubGFiZWxIZWlnaHQgKiBjb21tb25fZGVmYXVsdC5nZXRSb3dzKHJlbGF0aW9uLnRpdGxlKS5sZW5ndGgsXG4gICAgICAgIGxhYmVscG9zOiBcImNcIlxuICAgICAgfSxcbiAgICAgIFwiaWRcIiArIGNudFxuICAgICk7XG4gIH0pO1xuICBkYWdyZUxheW91dChncmFwaCk7XG4gIGxvZy5kZWJ1ZyhcIkdyYXBoIGFmdGVyIGxheW91dFwiLCBncmFwaC5ub2RlcygpKTtcbiAgY29uc3Qgc3ZnRWxlbSA9IGRpYWdyYW0yLm5vZGUoKTtcbiAgZ3JhcGgubm9kZXMoKS5mb3JFYWNoKGZ1bmN0aW9uKHYpIHtcbiAgICBpZiAodiAhPT0gdm9pZCAwICYmIGdyYXBoLm5vZGUodikgIT09IHZvaWQgMCkge1xuICAgICAgbG9nLndhcm4oXCJOb2RlIFwiICsgdiArIFwiOiBcIiArIEpTT04uc3RyaW5naWZ5KGdyYXBoLm5vZGUodikpKTtcbiAgICAgIHJvb3Quc2VsZWN0KFwiI1wiICsgc3ZnRWxlbS5pZCArIFwiICNcIiArIHYpLmF0dHIoXG4gICAgICAgIFwidHJhbnNmb3JtXCIsXG4gICAgICAgIFwidHJhbnNsYXRlKFwiICsgKGdyYXBoLm5vZGUodikueCAtIGdyYXBoLm5vZGUodikud2lkdGggLyAyKSArIFwiLFwiICsgKGdyYXBoLm5vZGUodikueSArICh0cmFuc2Zvcm1hdGlvbkxvZ1t2XSA/IHRyYW5zZm9ybWF0aW9uTG9nW3ZdLnkgOiAwKSAtIGdyYXBoLm5vZGUodikuaGVpZ2h0IC8gMikgKyBcIiApXCJcbiAgICAgICk7XG4gICAgICByb290LnNlbGVjdChcIiNcIiArIHN2Z0VsZW0uaWQgKyBcIiAjXCIgKyB2KS5hdHRyKFwiZGF0YS14LXNoaWZ0XCIsIGdyYXBoLm5vZGUodikueCAtIGdyYXBoLm5vZGUodikud2lkdGggLyAyKTtcbiAgICAgIGNvbnN0IGRpdmlkZXJzID0gZG9tRG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIiNcIiArIHN2Z0VsZW0uaWQgKyBcIiAjXCIgKyB2ICsgXCIgLmRpdmlkZXJcIik7XG4gICAgICBkaXZpZGVycy5mb3JFYWNoKChkaXZpZGVyKSA9PiB7XG4gICAgICAgIGNvbnN0IHBhcmVudCA9IGRpdmlkZXIucGFyZW50RWxlbWVudDtcbiAgICAgICAgbGV0IHBXaWR0aCA9IDA7XG4gICAgICAgIGxldCBwU2hpZnQgPSAwO1xuICAgICAgICBpZiAocGFyZW50KSB7XG4gICAgICAgICAgaWYgKHBhcmVudC5wYXJlbnRFbGVtZW50KSB7XG4gICAgICAgICAgICBwV2lkdGggPSBwYXJlbnQucGFyZW50RWxlbWVudC5nZXRCQm94KCkud2lkdGg7XG4gICAgICAgICAgfVxuICAgICAgICAgIHBTaGlmdCA9IHBhcnNlSW50KHBhcmVudC5nZXRBdHRyaWJ1dGUoXCJkYXRhLXgtc2hpZnRcIiksIDEwKTtcbiAgICAgICAgICBpZiAoTnVtYmVyLmlzTmFOKHBTaGlmdCkpIHtcbiAgICAgICAgICAgIHBTaGlmdCA9IDA7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGRpdmlkZXIuc2V0QXR0cmlidXRlKFwieDFcIiwgMCAtIHBTaGlmdCArIDgpO1xuICAgICAgICBkaXZpZGVyLnNldEF0dHJpYnV0ZShcIngyXCIsIHBXaWR0aCAtIHBTaGlmdCAtIDgpO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxvZy5kZWJ1ZyhcIk5vIE5vZGUgXCIgKyB2ICsgXCI6IFwiICsgSlNPTi5zdHJpbmdpZnkoZ3JhcGgubm9kZSh2KSkpO1xuICAgIH1cbiAgfSk7XG4gIGxldCBzdGF0ZUJveCA9IHN2Z0VsZW0uZ2V0QkJveCgpO1xuICBncmFwaC5lZGdlcygpLmZvckVhY2goZnVuY3Rpb24oZSkge1xuICAgIGlmIChlICE9PSB2b2lkIDAgJiYgZ3JhcGguZWRnZShlKSAhPT0gdm9pZCAwKSB7XG4gICAgICBsb2cuZGVidWcoXCJFZGdlIFwiICsgZS52ICsgXCIgLT4gXCIgKyBlLncgKyBcIjogXCIgKyBKU09OLnN0cmluZ2lmeShncmFwaC5lZGdlKGUpKSk7XG4gICAgICBkcmF3RWRnZShkaWFncmFtMiwgZ3JhcGguZWRnZShlKSwgZ3JhcGguZWRnZShlKS5yZWxhdGlvbik7XG4gICAgfVxuICB9KTtcbiAgc3RhdGVCb3ggPSBzdmdFbGVtLmdldEJCb3goKTtcbiAgY29uc3Qgc3RhdGVJbmZvID0ge1xuICAgIGlkOiBwYXJlbnRJZCA/IHBhcmVudElkIDogXCJyb290XCIsXG4gICAgbGFiZWw6IHBhcmVudElkID8gcGFyZW50SWQgOiBcInJvb3RcIixcbiAgICB3aWR0aDogMCxcbiAgICBoZWlnaHQ6IDBcbiAgfTtcbiAgc3RhdGVJbmZvLndpZHRoID0gc3RhdGVCb3gud2lkdGggKyAyICogY29uZi5wYWRkaW5nO1xuICBzdGF0ZUluZm8uaGVpZ2h0ID0gc3RhdGVCb3guaGVpZ2h0ICsgMiAqIGNvbmYucGFkZGluZztcbiAgbG9nLmRlYnVnKFwiRG9jIHJlbmRlcmVkXCIsIHN0YXRlSW5mbywgZ3JhcGgpO1xuICByZXR1cm4gc3RhdGVJbmZvO1xufSwgXCJyZW5kZXJEb2NcIik7XG52YXIgc3RhdGVSZW5kZXJlcl9kZWZhdWx0ID0ge1xuICBzZXRDb25mLFxuICBkcmF3XG59O1xuXG4vLyBzcmMvZGlhZ3JhbXMvc3RhdGUvc3RhdGVEaWFncmFtLnRzXG52YXIgZGlhZ3JhbSA9IHtcbiAgcGFyc2VyOiBzdGF0ZURpYWdyYW1fZGVmYXVsdCxcbiAgZGI6IHN0YXRlRGJfZGVmYXVsdCxcbiAgcmVuZGVyZXI6IHN0YXRlUmVuZGVyZXJfZGVmYXVsdCxcbiAgc3R5bGVzOiBzdHlsZXNfZGVmYXVsdCxcbiAgaW5pdDogLyogQF9fUFVSRV9fICovIF9fbmFtZSgoY25mKSA9PiB7XG4gICAgaWYgKCFjbmYuc3RhdGUpIHtcbiAgICAgIGNuZi5zdGF0ZSA9IHt9O1xuICAgIH1cbiAgICBjbmYuc3RhdGUuYXJyb3dNYXJrZXJBYnNvbHV0ZSA9IGNuZi5hcnJvd01hcmtlckFic29sdXRlO1xuICAgIHN0YXRlRGJfZGVmYXVsdC5jbGVhcigpO1xuICB9LCBcImluaXRcIilcbn07XG5leHBvcnQge1xuICBkaWFncmFtXG59O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///89732\n')}}]);